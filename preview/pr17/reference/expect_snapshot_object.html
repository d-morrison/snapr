<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Snapshot testing for R objects — expect_snapshot_object • snapr</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Snapshot testing for R objects — expect_snapshot_object"><meta name="description" content="A flexible wrapper around testthat::expect_snapshot_file() that allows
snapshotting any R object, not just data.frames. This function provides
a convenient interface for snapshot testing with sensible defaults for
serialization.
When using RDS format (the default), snapshots are compared using
diffobj::diffObj() which provides rich, visual diffs in
testthat::snapshot_review(). This makes it much easier to review
changes to complex R objects."><meta property="og:description" content="A flexible wrapper around testthat::expect_snapshot_file() that allows
snapshotting any R object, not just data.frames. This function provides
a convenient interface for snapshot testing with sensible defaults for
serialization.
When using RDS format (the default), snapshots are compared using
diffobj::diffObj() which provides rich, visual diffs in
testthat::snapshot_review(). This makes it much easier to review
changes to complex R objects."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">snapr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/d-morrison/snapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Snapshot testing for R objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/d-morrison/snapr/blob/copilot/use-diffobj-for-snapshot-review/R/expect_snapshot_object.R" class="external-link"><code>R/expect_snapshot_object.R</code></a></small>
      <div class="d-none name"><code>expect_snapshot_object.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A flexible wrapper around <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code> that allows
snapshotting any R object, not just data.frames. This function provides
a convenient interface for snapshot testing with sensible defaults for
serialization.</p>
<p>When using RDS format (the default), snapshots are compared using
<code><a href="https://rdrr.io/pkg/diffobj/man/diffObj.html" class="external-link">diffobj::diffObj()</a></code> which provides rich, visual diffs in
<code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code>. This makes it much easier to review
changes to complex R objects.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">expect_snapshot_object</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, writer <span class="op">=</span> <span class="va">save_rds</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An R object to snapshot. Can be any R object including lists,
models, data.frames, vectors, etc.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a> snapshot name (file extension added
automatically)</p></dd>


<dt id="arg-writer">writer<a class="anchor" aria-label="anchor" href="#arg-writer"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a> Function to write the object to a file.
Default is <code><a href="save_rds.html">save_rds()</a></code>.
Other options include <code><a href="save_json.html">save_json()</a></code>, <code><a href="save_deparse.html">save_deparse()</a></code>, <code><a href="save_csv.html">save_csv()</a></code>,
<code><a href="save_diffobj.html">save_diffobj()</a></code>.
Custom writer functions should accept <code>x</code> and return a file path.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file</a></code></p><dl><dt><code>binary</code></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> Please use the
<code>compare</code> argument instead.</p></dd>

    <dt><code>cran</code></dt>
<dd><p>Should these expectations be verified on CRAN? By default,
they are not, because snapshot tests tend to be fragile because they
often rely on minor details of dependencies.</p></dd>

    <dt><code>compare</code></dt>
<dd><p>A function used to compare the snapshot files. It should take
two inputs, the paths to the <code>old</code> and <code>new</code> snapshot, and return either
<code>TRUE</code> or <code>FALSE</code>. This defaults to <code>compare_file_text</code> if <code>name</code> has
extension <code>.r</code>, <code>.R</code>, <code>.Rmd</code>, <code>.md</code>, or <code>.txt</code>, and otherwise uses
<code>compare_file_binary</code>.</p>
<p><code>compare_file_binary()</code> compares byte-by-byte and
<code>compare_file_text()</code> compares lines-by-line, ignoring
the difference between Windows and Mac/Linux line endings.</p></dd>

    <dt><code>transform</code></dt>
<dd><p>Optionally, a function to scrub sensitive or stochastic
text from the output. Should take a character vector of lines as input
and return a modified character vector as output.</p></dd>

    <dt><code>variant</code></dt>
<dd><p>If not-<code>NULL</code>, results will be saved in
<code>_snaps/{variant}/{test}/{name}</code>. This allows you to create
different snapshots for different scenarios, like different operating
systems or different R versions.</p>
<p>Note that there's no way to declare all possible variants up front which
means that as soon as you start using variants, you are responsible for
deleting snapshot variants that are no longer used. (testthat will still
delete all variants if you delete the test.)</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><a href="https://rdrr.io/r/base/NULL.html" class="external-link">NULL</a> (from <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code>)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When using RDS format (the default), snapshots can vary across R versions
and platforms even with fixed serialization versions. Consider using
<code>variant = platform_variant()</code> for RDS snapshots to handle these
differences, or use text-based formats like JSON or deparse for more
stable snapshots across platforms and versions.</p>
<p>The RDS comparison uses <code><a href="https://rdrr.io/pkg/diffobj/man/diffObj.html" class="external-link">diffobj::diffObj()</a></code> internally, which provides
rich visual diffs in <code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code>. This is particularly
useful for complex objects like models, nested lists, or data structures
where byte-level comparison would be difficult to interpret.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Snapshot a list (using RDS format with platform/version variant)</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_object</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"config"</span>, variant <span class="op">=</span> <span class="fu"><a href="platform_variant.html">platform_variant</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot a model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_object</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">model</span>, name <span class="op">=</span> <span class="st">"model"</span>, variant <span class="op">=</span> <span class="fu"><a href="platform_variant.html">platform_variant</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot with JSON format (for human-readable diffs)</span></span></span>
<span class="r-in"><span><span class="co"># Text formats don't need variants</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_object</span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span>, name <span class="op">=</span> <span class="st">"iris"</span>, writer <span class="op">=</span> <span class="va">save_json</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot with deparse format</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_object</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"simple_list"</span>, writer <span class="op">=</span> <span class="va">save_deparse</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot with str() format (optimal for diffobj visualization)</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_object</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, b <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"complex_list"</span>,</span></span>
<span class="r-in"><span>  writer <span class="op">=</span> <span class="va">save_diffobj</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer></div>





  </body></html>

